# GitHub Action: Coverage Diff

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## Presentation

Publish diff coverage report as PR comment.

![Comment screenshot](comment.png)

This action operates on a json-summary report file as generated by most coverage tools.

It will analyze the json-summary report file (`coverage/coverage-summary.json`), and produce a diff coverage report with the json-summary file from repository's default branch.
Then it will publish the diff coverage report as comment to the PR.
If a comment had already previously be written, it will be updated.
The comment contains information on the evolution of coverage rate attributed to this PR, as well as the rate of coverage for lines that this PR introduces.


## Usage

### Minimal usage

```yaml
name: Coverage Diff

on:
  pull_request: {}

jobs:
  test:
    name: Coverage Diff
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 16
          cache: npm
      - run: npm install
      - run: npm run test
      - name: Coverage Diff
        uses: orsolli/coverage-diff-action@master
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
```

### Maximal usage

```yaml
name: Coverage Diff

on:
  push:
    branches:
      - master
      - main
  pull_request: {}

jobs:
  test:
    name: Coverage Diff
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 16
          cache: npm
      - run: npm install
      - run: npm run test
      - name: Coverage Diff
        uses: orsolli/coverage-diff-action@master
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}

          # Path of the json-summary file to analyze.
          coverage-filename: coverage/coverage-summary.json

          # Name of the json file containing the repository's default branch json-summary stored in the repo wiki.
          base-summary-filename: base-summary.json

          # If true, it will not fail even if the current branch's coverage is lower than the default branch's coverage.
          allowed-to-fail: false
```

### Pinning

On the examples above, the version was set to `master` (a branch).
You can also pin a specific version such as `v1.0.0` (a tag).

### Note on the state of this action

There is no automated test so it's possible that it fails at some point if a dependency breaks compatibility.

It's probably usable as-is, but you're welcome to offer feedback and, if you want, contributions.

## Contributing

If you want to help, please get in touch (open an issue or something).

## License

This project is licensed under the [MIT License](LICENSE.md).
